tools:
  signal-cli:
    type: http
    upstream: "http://127.0.0.1:18080"

    # Allow signal-cli operations called by OpenClaw
    jsonrpc_allow_methods:
      - send              # Send message to recipient/group/username
      - sendTyping        # Send typing indicator
      - sendReceipt       # Send read/viewed receipt
      - sendReaction      # Send/remove emoji reaction
      - getAttachment     # Download message attachment
      - version           # Get signal-cli version

    # Deny dangerous operations
    jsonrpc_deny_methods:
      - deleteEverything
      - removeAccount
      - unregister

    # Filter on phone numbers for sending methods
    jsonrpc_param_filters:
      # send: recipient field is an array, policy filters first element
      send:
        field: "recipient"
        allow_patterns:
          - "+1*"              # Allow all US numbers (customize as needed)
        deny_patterns: []

      # sendTyping: typing indicator to recipient
      sendTyping:
        field: "recipient"
        allow_patterns:
          - "+1*"
        deny_patterns: []

      # sendReceipt: read receipt to recipient
      sendReceipt:
        field: "recipient"
        allow_patterns:
          - "+1*"
        deny_patterns: []

      # sendReaction: reactions use plural "recipients" field
      sendReaction:
        field: "recipients"    # Note: plural form for this method
        allow_patterns:
          - "+1*"
        deny_patterns: []

    rate_limit:
      max_requests: 100  # Max 100 messages per minute
      window_secs: 60

    timeout_secs: 30

    audit:
      enabled: true
      log_body: false  # Set to true to log full JSON-RPC requests (debug mode)
      redact_patterns:
        - "recipient"     # Redact phone numbers in audit logs
        - "recipients"    # Redact recipients array
